<!DOCTYPE html>
<html>
<head>
    <title> Harley Ao - Project 5 </title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        img {
            border-radius: 8px;
        }
        nav a {
            color: rgba(17, 106, 87, 0.5);
        }
    </style>
</head>
<body>
    <nav style="display: flex; gap: 18px; align-items: center; padding: 10px 0; margin-bottom: 28px; border-bottom: 2px solid rgba(17, 106, 87, 0.5);">
        <a href="/index.html" style="text-decoration: none; font-weight: bold; padding: 6px 14px;">Home</a>
        <a href="/0/index.html" style="text-decoration: none; font-weight: bold; padding: 6px 14px;">Project 0</a>
        <a href="/1/index.html" style="text-decoration: none; font-weight: bold; padding: 6px 14px;">Project 1</a>
        <a href="/2/index.html" style="text-decoration: none; font-weight: bold; padding: 6px 14px;">Project 2</a>
        <a href="/3/index.html" style="text-decoration: none; font-weight: bold; padding: 6px 14px;">Project 3</a>
        <a href="/4/index.html" style="text-decoration: none; font-weight: bold; padding: 6px 14px;">Project 4</a>
        <a href="/5/index.html" style="text-decoration: none; font-weight: bold; padding: 6px 14px;">Project 5</a>
        <a href="https://cal-cs180.github.io/fa25/hw/proj5/index.html" style="margin-left: auto; text-decoration: none; font-weight: bold; padding: 6px 14px;">Spec</a>
    </nav>
    <h1 style="text-align: center;"> Project 5: Fun with Diffusion Models</h1>
    <h1> Part A: The Power of Diffusion Models</h1>
    <h2> Part 0: Setup </h2>
    <p> 
        To set up the environment, I loaded the DeepFloyd IF model and used Huggingface cluster A for generating prompt embeddings.
        I generated images with different inference steps (10 and 20) and seeds to find acceptable images for the prompts I selected.
        Here are some example images I generated using seed 676767.
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <h3 style="text-align: center;">  a photo of a hipster barista </h3>
            <a href="/5/media/part0_barista.png" target="_blank">
                <img src="/5/media/part0_barista.png" alt="a photo of a hipster barista" width="350">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> a photo of a dog </h3>
            <a href="/5/media/part0_dog.png" target="_blank">
                <img src="/5/media/part0_dog.png" alt="a photo of a dog" width="350">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> an oil painting of people around a campfire </h3>
            <a href="/5/media/part0_fireplace.png" target="_blank">
                <img src="/5/media/part0_fireplace.png" alt="an oil painting of people around a campfire" width="350">
            </a>
        </div>
    </div>
    <h2> Part 1: Sampling Loops </h2>
    <h3> 1.1: Implementing the Forward Process </h3>
    <p>
        First, we implement the forward process using this equation:
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/1.1_equations.png" target="_blank">
            <img src="/5/media/1.1_equations.png" height="150">
        </a>
    </div>
    <p>
        This equation adds noise and scales the image at each step.
        Below is the test image and the results after applying the forward process 250, 500, and 750 times.
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <a href="/5/media/1.1_test.png" target="_blank">
                <img src="/5/media/1.1_test.png" alt="test image of the campanile" height="200">
            </a>
        </div>
        <div>
            <a href="/5/media/1.1_results.png" target="_blank">
                <img src="/5/media/1.1_results.png" alt="results image" height="200">
            </a>
        </div>
    </div>
    <h3> 1.2: Classical Denoising </h3>
    <p>
        Next, we attempt to remove the noise using Gaussian blurring.
        However, this method is not very effective, as it removes little noise and blurs the image significantly.
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/1.2.png" target="_blank">
            <img src="/5/media/1.2.png" alt="gaussian denoise image" width="400">
        </a>
    </div>
    <h3> 1.3: One Step Denoising </h3>
    <p>
        Now, we'll try using a pretrained diffusion model instead.
        The model attempts to remove noise by predicting the noise added in the forward process.
        Compared to the Gaussian blurring from 1.2, this method is much more effective at denoising.
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/1.3.png" target="_blank">
            <img src="/5/media/1.3.png" alt="denoising image" width="700">
        </a>
    </div>
    <h3> 1.4: Implementing Iterative Denoising </h3>
    <p>
        To further improve denoising, we implement iterative denoising to repeat the one-step denoising.
        We do this using the following equation:
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <a href="/5/media/1.4_equation.png" target="_blank">
                <img src="/5/media/1.4_equation.png" height="100">
            </a>
        </div>
        <div>
            <a href="/5/media/1.4_variables.png" target="_blank">
                <img src="/5/media/1.4_variables.png" height="100">
            </a>
        </div>
    </div>
    <p>
        During each iteration, we remove some noise based on calculations using the noise scaling coefficients. 
        We denoise starting from timestep 990 to timestep 0 with a step size of 30. 
        Using an iterative approach resulted in more detailed images compared to the one-step denoising.
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <a href="/5/media/1.4_noisy.png" target="_blank">
                <img src="/5/media/1.4_noisy.png" width="250">
            </a>
        </div>
        <div>
            <a href="/5/media/1.4_loop05.png" target="_blank">
                <img src="/5/media/1.4_loop05.png" width="250">
            </a>
        </div>
        <div>
            <a href="/5/media/1.4_loop10.png" target="_blank">
                <img src="/5/media/1.4_loop10.png"  width="250">
            </a>
        </div>
        <div>
            <a href="/5/media/1.4_loop15.png" target="_blank">
                <img src="/5/media/1.4_loop15.png" width="250">
            </a>
        </div>
        <div>
            <a href="/5/media/1.4_loop20.png" target="_blank">
                <img src="/5/media/1.4_loop20.png" width="250">
            </a>
        </div>
    </div>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <a href="/5/media/1.4_iterative.png" target="_blank">
                <img src="/5/media/1.4_iterative.png" width="250">
            </a>
        </div>
        <div>
            <a href="/5/media/1.4_one_step.png" target="_blank">
                <img src="/5/media/1.4_one_step.png" width="250">
            </a>
        </div>
        <div>
            <a href="/5/media/1.4_gaussian.png" target="_blank">
                <img src="/5/media/1.4_gaussian.png"  width="250">
            </a>
        </div>
    </div>
    <h3> 1.5: Diffusion Model Sampling </h3>
    <p>
        We can also use the iterative denoise function to generate images from scratch by starting from pure noise.
        Here are some of the images I generated using the prompt, "a hight quality photo".
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/1.5.png" target="_blank">
            <img src="/5/media/1.5.png" alt="diffusion model sampling" height="200">
        </a>
    </div>
    <h3> 1.6: Classifer Free Guidance </h3>
    <p>
        Although the images from 1.5 seem to make out a plausible image, some of them look non-sensical.
        To fix this, we implement Classifier-Free Guidance (CFG) to generate conditional noise.
        In other words, the noise will not be fully random, as it will be influenced by the condition given by the model.
        The results below show results that resemble more plausible images compared to 1.5.
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <a href="/5/media/1.6_im1.png" target="_blank">
                <img src="/5/media/1.6_im1.png" width="200">
            </a>
        </div>
        <div>
            <a href="/5/media/1.6_im2.png" target="_blank">
                <img src="/5/media/1.6_im2.png" width="200">
            </a>
        </div>
        <div>
            <a href="/5/media/1.6_im3.png" target="_blank">
                <img src="/5/media/1.6_im3.png"  width="200">
            </a>
        </div>
        <div>
            <a href="/5/media/1.6_im4.png" target="_blank">
                <img src="/5/media/1.6_im4.png" width="200">
            </a>
        </div>
        <div>
            <a href="/5/media/1.6_im5.png" target="_blank">
                <img src="/5/media/1.6_im5.png" width="200">
            </a>
        </div>
    </div>
    <h3> 1.7: Image-to-image Translation </h3>
    <p>
        The process of adding noise to an image and then denoising it basically allows us to make edits to the image.
        During the denoising process, the diffusion model doesn't know what the original image looks like, so it has to rely on "creativity" to replace the noise.
        Here are the results of running the forward process, and then running the iterative denoise function using a starting index of [1, 3, 5, 7, 10, 20] steps on the Campanile and two album covers.
    </p>
    <h3 style="text-align: center;">  Campanile </h3>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <h3 style="text-align: center;"> 1 </h3>
            <a href="/5/media/1.7_campim1.png" target="_blank">
                <img src="/5/media/1.7_campim1.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 3 </h3>
            <a href="/5/media/1.7_campim2.png" target="_blank">
                <img src="/5/media/1.7_campim2.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 5 </h3>
            <a href="/5/media/1.7_campim3.png" target="_blank">
                <img src="/5/media/1.7_campim3.png"  width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 7 </h3>
            <a href="/5/media/1.7_campim4.png" target="_blank">
                <img src="/5/media/1.7_campim4.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 10 </h3>
            <a href="/5/media/1.7_campim5.png" target="_blank">
                <img src="/5/media/1.7_campim5.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 20 </h3>
            <a href="/5/media/1.7_campim6.png" target="_blank">
                <img src="/5/media/1.7_campim6.png" width="175">
            </a>
        </div>
    </div>
    <h3 style="text-align: center;"> Eternal Sunshine Album </h3>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <h3 style="text-align: center;"> 1 </h3>
            <a href="/5/media/1.7_esim1.png" target="_blank">
                <img src="/5/media/1.7_esim1.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 3 </h3>
            <a href="/5/media/1.7_esim2.png" target="_blank">
                <img src="/5/media/1.7_esim2.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 5 </h3>
            <a href="/5/media/1.7_esim3.png" target="_blank">
                <img src="/5/media/1.7_esim3.png"  width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 7 </h3>
            <a href="/5/media/1.7_esim4.png" target="_blank">
                <img src="/5/media/1.7_esim4.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 10 </h3>
            <a href="/5/media/1.7_esim5.png" target="_blank">
                <img src="/5/media/1.7_esim5.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 20 </h3>
            <a href="/5/media/1.7_esim6.png" target="_blank">
                <img src="/5/media/1.7_esim6.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> Original </h3>
            <a href="/5/media/eternal_sunshine.png" target="_blank">
                <img src="/5/media/eternal_sunshine.png" width="175">
            </a>
        </div>
    </div>
    <h3 style="text-align: center;"> Hit Me Hard and Soft Album </h3>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <h3 style="text-align: center;"> 1 </h3>
            <a href="/5/media/1.7_hmhasim1.png" target="_blank">
                <img src="/5/media/1.7_hmhasim1.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 3 </h3>
            <a href="/5/media/1.7_hmhasim2.png" target="_blank">
                <img src="/5/media/1.7_hmhasim2.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 5 </h3>
            <a href="/5/media/1.7_hmhasim3.png" target="_blank">
                <img src="/5/media/1.7_hmhasim3.png"  width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 7 </h3>
            <a href="/5/media/1.7_hmhasim4.png" target="_blank">
                <img src="/5/media/1.7_hmhasim4.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 10 </h3>
            <a href="/5/media/1.7_hmhasim5.png" target="_blank">
                <img src="/5/media/1.7_hmhasim5.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 20 </h3>
            <a href="/5/media/1.7_hmhasim6.png" target="_blank">
                <img src="/5/media/1.7_hmhasim6.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> Original </h3>
            <a href="/5/media/hit_me_hard_and_soft.jpg" target="_blank">
                <img src="/5/media/hit_me_hard_and_soft.jpg" width="175">
            </a>
        </div>
    </div>
    <h3> 1.7.1: Editing Hand-Drawn and Web Images </h3>
    <p>
        This process approaches hand-drawn and web images at a faster rate since these images are less complex.
        Here are the results of the same process run on Garfield, a tree drawing, and a smiling heart drawing.
    </p>
    <h3 style="text-align: center;"> Garfield </h3>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <a href="/5/media/1.7.1_garfield.png" target="_blank">
                <img src="/5/media/1.7.1_garfield.png" height="175">
            </a>
        </div>
        <div>
            <a href="/5/media/garfield.jpg" target="_blank">
                <img src="/5/media/garfield.jpg" height="175">
            </a>
        </div>
    </div>
    <h3 style="text-align: center;"> Tree </h3>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/1.7.1_tree.png" target="_blank">
            <img src="/5/media/1.7.1_tree.png" height="175">
        </a>
    </div>
    <h3 style="text-align: center;"> Smiling Heart </h3>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/1.7.1_heart.png" target="_blank">
            <img src="/5/media/1.7.1_heart.png" height="175">
        </a>
    </div>
    <h3> 1.7.2: Inpainting </h3>
    <p> 
        Time for inpainting!
        Using a binary mask, we can specify a specific area of the image to edit.
        We will replace everything within this area without any influence from the original image.
        Basically, we are generating a new image for just that area while keeping the rest of the image intact.
        Here are the results of inpainting on the Campanile an album cover, and a Binge coffee!
    </p>
    <h3 style="text-align: center;"> Campanile </h3>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <a href="/5/media/1.7.2_camp.png" target="_blank">
                <img src="/5/media/1.7.2_camp.png" height="200">
            </a>
        </div>
        <div>
            <a href="/5/media/1.7.2_camp_in.png" target="_blank">
                <img src="/5/media/1.7.2_camp_in.png" height="200">
            </a>
        </div>
    </div>
    <h3 style="text-align: center;"> Hit Me Hard and Soft Album </h3>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <a href="/5/media/1.7.2_hmhas.png" target="_blank">
                <img src="/5/media/1.7.2_hmhas.png" height="200">
            </a>
        </div>
        <div>
            <a href="/5/media/1.7.2_hmhas_in.png" target="_blank">
                <img src="/5/media/1.7.2_hmhas_in.png" height="200">
            </a>
        </div>
    </div>
    <h3 style="text-align: center;"> Binge Coffee </h3>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <a href="/5/media/1.7.2_binge.png" target="_blank">
                <img src="/5/media/1.7.2_binge.png" height="200">
            </a>
        </div>
        <div>
            <a href="/5/media/1.7.2_binge_in.png" target="_blank">
                <img src="/5/media/1.7.2_binge_in.png" height="200">
            </a>
        </div>
    </div>
    <h3> 1.7.3: Text-Conditional Image-to-image Translation </h3>
    <p>
        We've been guiding the process with the text prompt "a high quality photo" until now. 
        For the next few images, we use different prompts to guide the denoising process.
        You can see how the images start off looking more like the prompt, then gradually becoming more like the original images.
    </p>
    <h3 style="text-align: center;"> "Pencil" to Campanile </h3>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <h3 style="text-align: center;"> 1 </h3>
            <a href="/5/media/1.7.3_camp1.png" target="_blank">
                <img src="/5/media/1.7.3_camp1.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 3 </h3>
            <a href="/5/media/1.7.3_camp2.png" target="_blank">
                <img src="/5/media/1.7.3_camp2.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 5 </h3>
            <a href="/5/media/1.7.3_camp3.png" target="_blank">
                <img src="/5/media/1.7.3_camp3.png"  width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 7 </h3>
            <a href="/5/media/1.7.3_camp4.png" target="_blank">
                <img src="/5/media/1.7.3_camp4.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 10 </h3>
            <a href="/5/media/1.7.3_camp5.png" target="_blank">
                <img src="/5/media/1.7.3_camp5.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 20 </h3>
            <a href="/5/media/1.7.3_camp6.png" target="_blank">
                <img src="/5/media/1.7.3_camp6.png" width="175">
            </a>
        </div>
    </div>
    <h3 style="text-align: center;"> "Lithograph of Waterfalls" to Hit Me Hard and Soft Album </h3>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <h3 style="text-align: center;"> 1 </h3>
            <a href="/5/media/1.7.3_hmhas1.png" target="_blank">
                <img src="/5/media/1.7.3_hmhas1.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 3 </h3>
            <a href="/5/media/1.7.3_hmhas2.png" target="_blank">
                <img src="/5/media/1.7.3_hmhas2.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 5 </h3>
            <a href="/5/media/1.7.3_hmhas3.png" target="_blank">
                <img src="/5/media/1.7.3_hmhas3.png"  width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 7 </h3>
            <a href="/5/media/1.7.3_hmhas4.png" target="_blank">
                <img src="/5/media/1.7.3_hmhas4.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 10 </h3>
            <a href="/5/media/1.7.3_hmhas5.png" target="_blank">
                <img src="/5/media/1.7.3_hmhas5.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 20 </h3>
            <a href="/5/media/1.7.3_hmhas6.png" target="_blank">
                <img src="/5/media/1.7.3_hmhas6.png" width="175">
            </a>
        </div>
    </div>
    <h3 style="text-align: center;"> "Oil Painting of People around a Campfire" to Eternal Sunshine Album </h3>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <h3 style="text-align: center;"> 1 </h3>
            <a href="/5/media/1.7.3_es1.png" target="_blank">
                <img src="/5/media/1.7.3_es1.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 3 </h3>
            <a href="/5/media/1.7.3_es2.png" target="_blank">
                <img src="/5/media/1.7.3_es2.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 5 </h3>
            <a href="/5/media/1.7.3_es3.png" target="_blank">
                <img src="/5/media/1.7.3_es3.png"  width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 7 </h3>
            <a href="/5/media/1.7.3_es4.png" target="_blank">
                <img src="/5/media/1.7.3_es4.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 10 </h3>
            <a href="/5/media/1.7.3_es5.png" target="_blank">
                <img src="/5/media/1.7.3_es5.png" width="175">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> 20 </h3>
            <a href="/5/media/1.7.3_es6.png" target="_blank">
                <img src="/5/media/1.7.3_es6.png" width="175">
            </a>
        </div>
    </div>
    <h3> 1.8: Visual Anagrams </h3>
    <p>
        Now, we'll create visual anagrams using two different prompts.
        We denoise for one prompt, then flip the image upside down and denoise for the other prompt.
        Once we flip it back upright, average the noise estimates and use this to perform denoising.
        This alternating process will create images that look like one prompt when viewed normally, and the other when flipped upside down.
        Madame Morrible, M M, flip it around, what do we get? WICKED WITCH!!!
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <h3 style="text-align: center;"> Oil Painting of an Old Man </h3>
            <a href="/5/media/1.8_im1.png" target="_blank">
                <img src="/5/media/1.8_im1.png" width="400">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> Oil Painting of People Around a Campfire </h3>
            <a href="/5/media/1.8_im1f.png" target="_blank">
                <img src="/5/media/1.8_im1f.png" width="400">
            </a>
        </div>
    </div>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <h3 style="text-align: center;"> Oil Painting of a Snowy Mountain Village </h3>
            <a href="/5/media/1.8_im2.png" target="_blank">
                <img src="/5/media/1.8_im2.png" width="400">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> Oil Painting of People Around a Campfire </h3>
            <a href="/5/media/1.8_im2f.png" target="_blank">
                <img src="/5/media/1.8_im2f.png" width="400">
            </a>
        </div>
    </div>
    <h3> 1.9: Hybrid Images </h3>
    <p>
        To create hybrid images, we estimate the noise for two different prompts.
        Then, we combine low frequencies from one noise estimate with high frequencies from the other.
        Finally, we use this combined noise estimate to perform denoising.
        From different viewing distances, the same image looks like one of the two prompts!
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <h3 style="text-align: center;"> Lithograph of Waterfalls </h3>
            <a href="/5/media/1.9_im1.png" target="_blank">
                <img src="/5/media/1.9_im1.png" width="400">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> Lithograph of a skull </h3>
            <a href="/5/media/1.9_im1.png" target="_blank">
                <img src="/5/media/1.9_im1.png" width="100">
            </a>
        </div>
    </div>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <h3 style="text-align: center;"> Oil Painting of a Mountain Village </h3>
            <a href="/5/media/1.9_im2.png" target="_blank">
                <img src="/5/media/1.9_im2.png" width="50">
            </a>
        </div>
        <div>
            <h3 style="text-align: center;"> Lithograph of Waterfalls </h3>
            <a href="/5/media/1.9_im2.png" target="_blank">
                <img src="/5/media/1.9_im2.png" width="300">
            </a>
        </div>
    </div>
    <h1> Part B: The Power of Diffusion Models</h1>
    <h2> Part 1: Training a Single-Step Denoising UNet </h2>
    <h3> 1.1: Implementing the UNet </h3>
    <p>
        We first build our UNet by implementing convolutional, downsampling, and upsampling blocks.
        There are also flatten and unflatten blocks that convert tensors between 1x1 and 7x7 dimensions.
        Additionally, we implement unconditional UNet by convolving the image, downsampling twice, and flattening it.
        Then, we unflatten, upsample twice, and convolve it back to the original image dimensions.
        Here is the full structure:
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b1.1_1.png" target="_blank">
            <img src="/5/media/b1.1_1.png" width="1000">
        </a>
    </div>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b1.1_2.png" target="_blank">
            <img src="/5/media/b1.1_2.png" width="1000">
        </a>
    </div>
    <h3> 1.2: Using the UNet to Train a Denoiser </h3>
    <p>
        Before we train the denoiser, we need to generate data pairs of clean MNIST digits and their noisy counterparts.
        The noisy MNIST digit is created by adding Gaussian noise to the clean digit using a noise scaling coefficient, sigma.
        The larger the coefficient, the noisier the visualization is.
        Below is the visualization of clean and noisy MNIST digits with different sigma values.
    </p>
     <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b1.2.png" target="_blank">
            <img src="/5/media/b1.2.png" width="700">
        </a>
    </div>
    <h3> 1.2.1: Training </h3>
    <p>
        For training, we used the Adam Optimizer and MSELoss to train our UnconditionalUNet model with the following recommended hyperparameters:
    </p>
    <ul>
        <li> Batch size: 256 </li>
        <li> Learning rate: 1e-4 </li>
        <li> Number of epochs: 5 </li>
        <li> Noise level: 0.5 </li>
        <li> Hidden Dimension: 128 </li>
    </ul>
    <p>
        This resulted in the following loss curve:
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b1.2.1_graph.png" target="_blank">
            <img src="/5/media/b1.2.1_graph.png" width="700">
        </a>
    </div>
    <p>
        These were the resulting visualizations of the denoising process after training epochs 1 and 5:
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <a href="/5/media/b1.2.1_e1.png" target="_blank">
                <img src="/5/media/b1.2.1_e1.png" width="400">
            </a>
        </div>
        <div>
            <a href="/5/media/b1.2.1_e5.png" target="_blank">
                <img src="/5/media/b1.2.1_e5.png" width="400">
            </a>
        </div>
    </div>
    <h3> 1.2.2: Out-of-Distribution Testing </h3>
    <p>
        Here is the performance of our trained denoiser on different sigma values.
        The denoiser performs substantially on sigma values from 0 to 0.6, but becomes less clear as the sigma increases to 0.8 and 1.0.
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b1.2.2_1.png" target="_blank">
            <img src="/5/media/b1.2.2_1.png" width="400">
        </a>
    </div>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b1.2.2_2.png" target="_blank">
            <img src="/5/media/b1.2.2_2.png" width="400">
        </a>
    </div>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b1.2.2_3.png" target="_blank">
            <img src="/5/media/b1.2.2_3.png" width="400">
        </a>
    </div>
    <h3> 1.2.3: Denoising Pure Noise </h3>
    <p>
        Now, we use our model to denoise images that are pure noise. 
        Compared to the training curve graph, the loss curve converges much faster.
        6 samples of the results from the denoising process are also displayed below.
        The outputs look like a 3 or 8, and the outputs from epoch 5 look clearer than those from epoch 1.
        This is interesting, as part of the number 8 could be erased to represent all digits 0-9 in some sense.
        All the digit visualizations we used to train our model overlap with each other, averaging out to look like an 8.
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b1.2.3_graph.png" target="_blank">
            <img src="/5/media/b1.2.3_graph.png" width="600">
        </a>
    </div>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
             <h3 style="text-align: center;"> Epoch 1 </h3>
            <a href="/5/media/b1.2.3_e1.1.png" target="_blank">
                <img src="/5/media/b1.2.3_e1.1.png" width="300">
            </a>
        </div>
        <div>
             <h3 style="text-align: center;"> Epoch 5 </h3>
            <a href="/5/media/b1.2.3_e5.1.png" target="_blank">
                <img src="/5/media/b1.2.3_e5.1.png" width="300">
            </a>
        </div>
    </div>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <div>
            <a href="/5/media/b1.2.3_e1.2.png" target="_blank">
                <img src="/5/media/b1.2.3_e1.2.png" width="300">
            </a>
        </div>
        <div>
            <a href="/5/media/b1.2.3_e5.2.png" target="_blank">
                <img src="/5/media/b1.2.3_e5.1.png" width="300">
            </a>
        </div>
    </div>
    <h2> Part 2: Training a Flow Matching Model </h2>
    <h3> 2.1: Adding Time Conditioning to UNet </h3>
    <p>
        Now, we build a new UNet model that incorporates time conditioning, which uses an FCBLock class to embed the time step t into a higher dimensional space.
        Conditioning our model means that we can handle various levels of noise during training and diffusion.
        Below is the new structure:
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b2.1_1.png" target="_blank">
            <img src="/5/media/b2.1_1.png" width="1000">
        </a>
    </div>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b2.1_2.png" target="_blank">
            <img src="/5/media/b2.1_2.png" width="800">
        </a>
    </div>
    <h3> 2.2: Training the UNet </h3>
    <p>
        For training, we changed the following hyperparameters:
    </p>
    <ul>
        <li> Batch size: 64 </li>
        <li> Learning rate: 1e-2 </li>
        <li> Number of epochs: 10 </li>
        <li> Hidden Dimension: 64 </li>
    </ul>
    <p>
        Below is the training curve:
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b2.2.png" target="_blank">
            <img src="/5/media/b2.2.png" width="600">
        </a>
    </div>
    <h3> 2.3: Sampling from the Time-Conditioned UNet </h3>
    <p>
        Below are the results for sampling from our trained time-conditioned UNet model for different epoch numbers.
        The outputs resemble digits much more clearly in epoch 5 compared to epoch 1.
        However, the difference between epoch 5 and epoch 10 is less noticeable.
        Not all samples are fully recognziable digits, by epoch 10.
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b2.3_e1.png" target="_blank">
            <img src="/5/media/b2.3_e1.png" width="800">
        </a>
    </div>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b2.3_e5.png" target="_blank">
            <img src="/5/media/b2.3_e5.png" width="800">
        </a>
    </div>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b2.3_e10.png" target="_blank">
            <img src="/5/media/b2.3_e10.png" width="800">
        </a>
    </div>
    <h3> 2.4: Adding Class-Conditioning to UNet </h3>
    <p>
        In addition to a time conditioning block, we also add a class conditioning block to our UNet model.
        This block helps create a model conditioned on the digit class 0-9 to further improve the denoising performance.
        During training, we randomly select a class label for each image in the batch and embed it using the FCBLock class.
    </p>
    <h3> 2.5: Training the UNet </h3>
    <p>
        We use the same hyperparameters as in section 2.2 for training.
        The following training curve on average looks more consistent in terms of average loss per iteration.
        The vertical span is somewhat smaller than when there was no class conditioning.
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b2.5.png" target="_blank">
            <img src="/5/media/b2.5.png" width="600">
        </a>
    </div>
    <h3> 2.6: Sampling from the UNet </h3>
    <p>
        Now, we sample from our trained class-conditioned UNet model for epochs 1, 5, and 10.
        The outputs look much clearer as we approach epoch 5 and epoch 10.
        Compared to the samples from 2.3, the digits are much more identifiable.
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b2.6_1.png" target="_blank">
            <img src="/5/media/b2.6_1.png" width="800">
        </a>
    </div>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b2.6_2.png" target="_blank">
            <img src="/5/media/b2.6_2.png" width="800">
        </a>
    </div>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b2.6_3.png" target="_blank">
            <img src="/5/media/b2.6_3.png" width="800">
        </a>
    </div>
    <p>
        Below are the samples generated after removing the learning rate scheduler.
        To compensate, I lowered the learning rate from 1e-2 to 3e-3 to stabilize training and to anticipate the smaller effective learning rate in the later epochs.
        Below are the results for epochs 1, 5, and 10 without the learning rate scheduler.
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b2.6_4.png" target="_blank">
            <img src="/5/media/b2.6_4.png" width="800">
        </a>
    </div>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b2.6_5.png" target="_blank">
            <img src="/5/media/b2.6_5.png" width="800">
        </a>
    </div>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b2.6_6.png" target="_blank">
            <img src="/5/media/b2.6_6.png" width="800">
        </a>
    </div>
    <p>
        I have also included an loss graph comparison between training with and without the learning rate scheduler.
        The loss curve with the scheduler starts out higher than the model without, which corroborates with the epoch 1 results.
        They both converge to similar loss values, which is also reflected by the samples from epochs 5 and 10.
    </p>
    <div style="display: flex; gap: 20px; justify-content: center;">
        <a href="/5/media/b2.6_graph.png" target="_blank">
            <img src="/5/media/b2.6_graph.png" width="800">
        </a>
    </div>
</body>
</html>
